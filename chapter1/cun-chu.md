# 存储

TODO：学习CoreData、Kache源码

## 数据结构

`数据结构`：数据存在的形式。  
数据结构有哪些？

## 存储方式

存储方式分两种：内存和闪存  
`内存存储`：是临时的，运行时有效，效率高。  
`闪存`：持久化存储，但产生I/O消耗，效率相对低。![](/assets/存储方案示意图.png)

```
                                                 存储方案示意图
```

四种数据存储方式：

* NSUserDefaults：用于存储配置信息。
* SQLite：用于存储查询需求较多的信息。
* CoreData：用于规划应用中的对象
* 使用基本对象类型定制的存储方案



### NSUserDefaults

`NSUserDefaults`被设计用来存储设备和用户的配置信息。
`NSUserDefaults`以字典的形式把配置信息组织起来，支持基础类型数据的存储。可以通过- (NSDictionary<NSString *, id> *)dictionaryRepresentation方法取得对应的字典打印出存储的数据。
![](/assets/2.png)
[NSUserDefaults standardUserDefaults]中的数据

`NSUserDefaults`会将所有数据都放到内存里，因此操作速度很快。开发者自定义的配置项会以plist格式的文件归档在应用目录的/Library/Preferences/[App_Bundle_Identifier].plist文件。再次初始化获得实例对象后，框架会把用户自定义的配置信息和系统的配置信息合并并得到完整数据。


### SQLite

SQLite是遵守ACID的`关系数据库管理系统`。
iOS的SDK内置了SQLite的库。
SQLite每次写入数据都会产生IO消耗，把数据归档到相应的文件。
一般来说应用中`格式化的文本数据`可以存放在数据库中，尤其是类似聊天记录、TimeLine等这些具有条件查询和排序需求的数据。

每一个数据库的句柄都会在内内存中被分配一段缓存，用于提高查询效率。另一方面由于查询缓存，当产生大量句柄或数据量过大时，会出现缓存过大，造成内存浪费。

针对SQLite的封装：把相对复杂的SQLite命令封装成对象和方法。


#### 数据库相关概念

`数据库`（英语：Database）：是以一定的方式存储在一起、能予多个用户共享、具有尽可能小的冗余度、与应用程序彼此独立的数据集合。用户可以对其中的数据进行新增、截取、更新、删除等操作。  
`关系数据库`：创建在`关系模型`基础上的数据库，借助于集合代数等数学概念和方法来处理数据库中的数据。  
`SQL`（英语：Structured Query Language）：一种基于`关系数据库`的标准数据查询语言，这种语言执行对关系数据库中数据的检索和操作。  
`关系模型`：是采用二维表格结构表达实体类型以及实体间联系的数据模型。  
`数据库管理系统`（英语：Database Management System，缩写：DBMS）：是一种针对对象数据库，为管理数据库二设计的大型电脑软件管理系统。

`数据库索引`：是数据库管理系统中一个排序的数据结构，已协助快速查询、更新数据库表中数据。不可重复，不能为空。  
`事务`（英语：transaction）：是用户定义的一个数据库操作序列。这些操作要么全做，要么全不做，是一个不可分区的工作单位。


### CoreData
CoreData是一个模型层的技术。

官方：一个持久化的，对象图和生命周期的自动化`管理方案`。它可以把整个应用中的对象建模并进行自动化的管理。
严格上来说CoreData是一个管理方案，它的持久化可以通过SQLite、XML或二进制文件储存。



参考文章：[我为什么不喜欢 Core Data](http://blog.devtang.com/2016/08/04/i-do-not-like-core-data/)
正准备去学习CoreData的时候，看到了唐巧的这篇博客，哈哈。之前也看了一些相关的文章，基本都看不懂，这下好了，直接不用学了。
总结下就是：CoreData相关概念难以理解，学习成本太高。使用起来也很复杂，使用成本也高。然后还有很多坑，维护成本高。总之就是成本高，收益少。


### 使用基本数据对象定制的缓存方案
![](/assets/5.png)
Kache架构图




参考文章：  
[对比iOS中的四种数据存储](http://www.infoq.com/cn/articles/data-storage-in-ios)
